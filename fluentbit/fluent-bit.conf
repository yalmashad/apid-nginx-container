[SERVICE]
    Flush        1
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf

# 1️⃣  Tail only the NGINX container logs
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*.log
    Tag               nginx.*
    Parser            docker
    Refresh_Interval  10
    Skip_Long_Lines   On
    Mem_Buf_Limit     50MB

# 2️⃣  Filter: include only NGINX container logs (based on container name)
[FILTER]
    Name              grep
    Match             nginx.*
    Regex             log   nginx

# 3️⃣  Filter: further narrow to API-related entries
# Matches JSON access logs (obelixfwd) or NJS “LOG-PAYLOAD” lines
[FILTER]
    Name              grep
    Match             nginx.*
    Regex             log   (public-api|LOG-PAYLOAD)

# 4️⃣  Output: ship only filtered logs to Obelix
[OUTPUT]
    Name              http
    Match             nginx.*
    Host              obelix
    Port              18093
    URI               /logs/third_party_application/access
    Format            json_lines
    Json_date_key     time
    Json_date_format  iso8601
    Retry_Limit       False

